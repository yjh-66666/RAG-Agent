# 401 错误排查指南

## ❌ 常见错误

### 错误 1：Token 格式不正确

**错误示例：**
```
Bearer<token>          ❌ 缺少空格
bearer <token>         ❌ Bearer 必须大写
<token>                ❌ 缺少 Bearer 前缀
"Bearer <token>"       ❌ 不需要引号
```

**正确格式：**
```
Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### 错误 2：Token 已过期

**解决方法：** 重新调用 `/auth/dev_login` 获取新 token

### 错误 3：没有点击 "Authorize" 按钮

即使你复制了 token，也必须：
1. 点击右上角 "Authorize" 按钮
2. 在弹出框中输入 `Bearer <token>`
3. 点击 "Authorize" 按钮确认

## ✅ 正确的授权流程

### 方式一：使用 API 文档界面（推荐）

1. **获取 Token**
   - 调用 `/auth/dev_login`
   - 复制 `access_token`

2. **授权**
   - 点击右上角 "Authorize" 🔓
   - 输入：`Bearer <你的token>`
   - 点击 "Authorize"
   - 点击 "Close"

3. **验证**
   - 看到右上角显示 "Authorized" ✅
   - 所有接口的锁图标变成绿色

### 方式二：直接在请求中添加 Header

如果你使用 curl 或其他工具，在请求头中添加：

```bash
curl -X POST "http://127.0.0.1:8000/ingest" \
  -H "Authorization: Bearer <你的token>" \
  -H "Content-Type: application/json" \
  -d '{"paths": ["./demo_docs"]}'
```

## 🔍 如何验证 Token 是否有效

访问 `/health` 接口（不需要授权）：
```
http://127.0.0.1:8000/health
```

如果返回正常，说明服务器运行正常，问题在授权上。

## 💡 快速测试方法

运行自动化脚本，它会自动处理授权：
```bash
python demo_script.py
```
